<!DOCTYPE html> <html lang="es"> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" crossorigin="anonymous"> <link rel="stylesheet" href="/assets/main.css"> <link rel="canonical" href="http://0.0.0.0:4000/2020/11/08/rpi-usando-fail2ban.html"> <link rel="alternate" type="application/rss+xml" title="Si lo haces, hazlo bien" href="/feed.xml"> <!-- --> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Raspberry Pi. Instalar y configurar fail2ban | Si lo haces, hazlo bien</title> <meta name="generator" content="Jekyll v4.3.1" /> <meta property="og:title" content="Raspberry Pi. Instalar y configurar fail2ban" /> <meta name="author" content="Vctrsnts" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Siguiendo con mis capitulos con respecto a la configuración y uso de mi RPI4 (tambien explicado en este otro articulo, pues ahora pasamos a añadir una protección más y que en todos los sitios donde explican su configuración, se preguntan, porque no esta instalada por defecto en todos los sistemas GNU/Linux." /> <meta property="og:description" content="Siguiendo con mis capitulos con respecto a la configuración y uso de mi RPI4 (tambien explicado en este otro articulo, pues ahora pasamos a añadir una protección más y que en todos los sitios donde explican su configuración, se preguntan, porque no esta instalada por defecto en todos los sistemas GNU/Linux." /> <link rel="canonical" href="http://0.0.0.0:4000/2020/11/08/rpi-usando-fail2ban.html" /> <meta property="og:url" content="http://0.0.0.0:4000/2020/11/08/rpi-usando-fail2ban.html" /> <meta property="og:site_name" content="Si lo haces, hazlo bien" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2020-11-08T00:00:00+00:00" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Raspberry Pi. Instalar y configurar fail2ban" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Vctrsnts"},"dateModified":"2020-11-08T00:00:00+00:00","datePublished":"2020-11-08T00:00:00+00:00","description":"Siguiendo con mis capitulos con respecto a la configuración y uso de mi RPI4 (tambien explicado en este otro articulo, pues ahora pasamos a añadir una protección más y que en todos los sitios donde explican su configuración, se preguntan, porque no esta instalada por defecto en todos los sistemas GNU/Linux.","headline":"Raspberry Pi. Instalar y configurar fail2ban","mainEntityOfPage":{"@type":"WebPage","@id":"http://0.0.0.0:4000/2020/11/08/rpi-usando-fail2ban.html"},"url":"http://0.0.0.0:4000/2020/11/08/rpi-usando-fail2ban.html"}</script> <!-- End Jekyll SEO tag --> </head> <body> <header id="nav-header" class="border-dark border-left-0 border-right-0"> <div id="nav-container" class="container position-relative d-flex justify-content-between align-items-center"> <a class="h4 m-0 text-dark" href="/">Si lo haces, hazlo bien</a> <nav id="nav-menu-container" class="text-right navbar-light"> <input type="checkbox" id="nav-trigger" class="d-none"/> <label for="nav-trigger" aria-label="button" class="m-2 d-inline-block d-md-none navbar-toggler-icon"> </label> <div id="nav-menu" class="d-none d-md-block"> <a class="text-dark ml-3 ml-md-0 p-2 d-block d-md-inline-block" href="/about/">About</a> <a class="text-dark ml-3 ml-md-0 p-2 d-block d-md-inline-block" href="/posts/">Posts</a> </div> </nav> </div> </header> <main aria-label="Content"> <div id="content-container" class="container"> <article itemscope itemtype="http://schema.org/BlogPosting"> <header class="pt-4 pb-3"> <h1 itemprop="name headline">Raspberry Pi. Instalar y configurar fail2ban</h1> <p class="text-secondary"> <time datetime="2020-11-08T00:00:00+00:00" itemprop="datePublished"> Nov 8, 2020 </time> </p> </header> <div class="text-justify" itemprop="articleBody" id="content"> <p>Siguiendo con mis capitulos con respecto a la configuración y uso de mi RPI4 (tambien explicado en este otro <a href="/2020/10/30/rpi-cambiando-equipo.html">articulo</a>, pues ahora pasamos a añadir una protección más y que en todos los sitios donde explican su configuración, se preguntan, porque no esta instalada por defecto en todos los sistemas GNU/Linux.</p> <p>Esta protección es <strong>fail2ban</strong>.</p> <!--more--> <p>Su funcionalidad es la de monitorizar todos los intentos de conexión a los servicios que hayas indicado en el fichero de configuración, <code class="language-plaintext highlighter-rouge">jail.local</code> y cuando ve que una <code class="language-plaintext highlighter-rouge">IP</code> intenta hacer más de un intento fallido, <em>bloquea - banea</em> durante el tiempo que tu hayas indicado.</p> <p>Ahora, pasamos a explicar unos cuantos conceptos del fichero de configuración :</p> <ul> <li><strong>maxretry</strong>: Cuantos intentos de conexión se aceptan antes del bloqueo / baneo.</li> <li><strong>fintime</strong>: Es durante cuanto tiempo se monitoriza una IP antes de activarse la opcion <strong>maxretry</strong></li> <li><strong>bantime</strong>: Cuanto tiempo permanecera baneada la ip de donde ha venido el intento de conexión. En el caso de que quieras ser agresivo, puedes poner más tiempo. En mi caso lo tengo con que el baneo sea de 1 dia (86.400 segundos).</li> <li><strong>ignoreip</strong>: Para ignorar los intentos de conexión fallidos que vienen de nuestra propia red.</li> </ul> <p>Ahora pasamos a su modificación.</p> <p>Lo que he leido en todos sitios con respecto a <strong>fail2ban</strong>, es que lo mejor es copiar el fichero <code class="language-plaintext highlighter-rouge">jail.conf</code> a <code class="language-plaintext highlighter-rouge">jail.local</code>.</p> <figure class="highlight"><pre><code class="language-terminal" data-lang="terminal"><span class="gp">  usuari@raspberry:~$</span><span class="w"> </span><span class="nb">cd</span> /etc
<span class="gp">  usuari@raspberry:~$</span><span class="w"> </span><span class="nb">sudo cp </span>jail.conf jail.local</code></pre></figure> <p>Una vez hecho esto, ya lo podemos editar con las opciones que más nos interesan que en mi caso son las siguiente :</p> <figure class="highlight"><pre><code class="language-bash" data-lang="bash">  <span class="c"># descomentar la opción ignoreip para que no tenga en cuenta los accesos</span>
  <span class="c"># que vienen de nuestra propia red</span>
  ignoreip <span class="o">=</span> 127.0.0.1/8 ::1
  <span class="c"># descomentamos la opción bantime y en mi caso he puesto 86400</span>
  bantime <span class="o">=</span> 86400
  <span class="c"># descomentamos la opcion fintime y yo he dejado el valor por defeccto</span>
  fintime <span class="o">=</span> 10m</code></pre></figure> <p>Ahora pasamos a activar los modulos que nos interesa que en mi caso es el modulo de <code class="language-plaintext highlighter-rouge">sshd</code>. Los modulos se encuentran a partir de la opción <code class="language-plaintext highlighter-rouge">JAILS</code>.</p> <p>Se activan con la opción <code class="language-plaintext highlighter-rouge">enabled = true</code>. Y en mi caso el modulo de <code class="language-plaintext highlighter-rouge">SSHD</code> queda de la siguiente manera :</p> <figure class="highlight"><pre><code class="language-bash" data-lang="bash">  enabled <span class="o">=</span> <span class="nb">true
  </span>filter <span class="o">=</span> sshd
  <span class="c"># Aqui es donde ponemos los puertos a controlar. Si ponemos ssh,</span>
  <span class="c"># se monitoriza el puerto por defecto de ssh (22), pero</span>
  <span class="c"># tambien podemos poner otros puertos.</span>
  port <span class="o">=</span> ssh, xxxx</code></pre></figure> <p>Si revisas los modulos disponibles, ves que hay un monto, por ejemplo <code class="language-plaintext highlighter-rouge">dropbear</code>, <code class="language-plaintext highlighter-rouge">apache</code>, <code class="language-plaintext highlighter-rouge">nginx</code>, <code class="language-plaintext highlighter-rouge">lighttpd</code> y unos cuantos más.</p> <p>De esta manera ya tenemos configurado <strong>fail2ban</strong>, ahora solamente falta activarlo :</p> <figure class="highlight"><pre><code class="language-terminal" data-lang="terminal"><span class="gp">  usuari@raspberry:~$</span><span class="w"> </span><span class="nb">sudo</span> /etc/init.d/fail2ban start</code></pre></figure> <p>Y disfrutar de los baneos, que puedes ver, en el fichero de los :</p> <figure class="highlight"><pre><code class="language-terminal" data-lang="terminal"><span class="gp">  usuari@raspberry:~$</span><span class="w"> </span><span class="nb">sudo tail</span> <span class="nt">-f</span> /var/log/fail2ban.log</code></pre></figure> <blockquote> <p>Que como dice un youtuber famoso <a href="https://www.youtube.com/channel/UCrBzBOMcUVV8ryyAU_c6P5g">PeladoNerd</a>, es un ejercicio muy saludable.</p> </blockquote> <p>Asi mismo, tambien pongo el codigo necesario para poder <code class="language-plaintext highlighter-rouge">desbanear</code> nuestra ip de acceso a la raspberry (me ha pasado más de una vez), lo que se tiene que hacer es lo siguiente:</p> <figure class="highlight"><pre><code class="language-terminal" data-lang="terminal"><span class="gp">  usuari@raspberry:~$</span><span class="w"> </span>fail2ban-client <span class="nb">set </span>sshd unbanip x.x.x.x
<span class="gp">  #</span><span class="w"> </span>Donde x.x.x.x es la ip</code></pre></figure> <p>Ten en cuenta, que esto lo tienes que hacer desde otro PC, porque desde el que tienes acceso normalmente no te dejara acceder, si es que no le cambias la ip</p> <h4 id="referencia">Referencia</h4> <ul> <li><a href="https://elblogdelazaro.gitlab.io/2017-10-05-fail2ban-raspberry">fail2ban en una Raspberry Pi</a></li> <li><a href="https://www.youtube.com/watch?v=PAK7I1cKwzA">ESTO TENDRIA QUE VENIR POR DEFECTO EN LINUX - V2M / fail2ban</a></li> <li><a href="http://support.moonpoint.com/os/unix/linux/fail2ban-unban.php">Desbanear IP</a></li> </ul> </div> </article> </div> </main> <footer id="site-footer"> <div class="container"> <div class="h5 pt-4">Si lo haces, hazlo bien</div> <div class="row"> <div class="col col-lg-3"> <ul class="list-unstyled"> <li class="text-secondary"> Vctrsnts </li> </ul> </div> <div class="col-6 col-lg-3"> <ul class="list-unstyled"> <li> <a href="https://github.com/Vctrsnts"> <span class="align-middle text-secondary pr-2"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="16" height="16"><title>GitHub</title><path fill="currentColor" d="M8 .43C3.714.43.24 3.905.24 8.192c0 3.428 2.223 6.337 5.307 7.363.388.07.53-.168.53-.374l-.01-1.32c-2.16.47-2.614-1.04-2.614-1.04-.353-.896-.862-1.135-.862-1.135-.705-.48.053-.472.053-.472.78.055 1.19.8 1.19.8.692 1.186 1.816.843 2.258.645.07-.502.27-.843.493-1.037-1.723-.197-3.534-.862-3.534-3.836 0-.847.302-1.54.8-2.082-.08-.197-.347-.986.076-2.054 0 0 .652-.21 2.134.796A7.39 7.39 0 0 1 8 4.184a7.45 7.45 0 0 1 1.943.261c1.482-1.004 2.132-.796 2.132-.796.423 1.068.157 1.857.077 2.054.497.542.798 1.235.798 2.082 0 2.98-1.814 3.637-3.543 3.83.28.24.527.713.527 1.437l-.01 2.13c0 .208.14.45.534.373 3.08-1.028 5.302-3.935 5.302-7.362C15.76 3.906 12.285.43 8 .43z"/></svg></span><span>Vctrsnts</span> </a> </li> <li> <a href="https://mastodon.online/@vsantos"> <span class="align-middle text-secondary pr-2"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-mastodon" viewBox="0 0 16 16"> <path d="M11.19 12.195c2.016-.24 3.77-1.475 3.99-2.603.348-1.778.32-4.339.32-4.339 0-3.47-2.286-4.488-2.286-4.488C12.062.238 10.083.017 8.027 0h-.05C5.92.017 3.942.238 2.79.765c0 0-2.285 1.017-2.285 4.488l-.002.662c-.004.64-.007 1.35.011 2.091.083 3.394.626 6.74 3.78 7.57 1.454.383 2.703.463 3.709.408 1.823-.1 2.847-.647 2.847-.647l-.06-1.317s-1.303.41-2.767.36c-1.45-.05-2.98-.156-3.215-1.928a3.614 3.614 0 0 1-.033-.496s1.424.346 3.228.428c1.103.05 2.137-.064 3.188-.189zm1.613-2.47H11.13v-4.08c0-.859-.364-1.295-1.091-1.295-.804 0-1.207.517-1.207 1.541v2.233H7.168V5.89c0-1.024-.403-1.541-1.207-1.541-.727 0-1.091.436-1.091 1.296v4.079H3.197V5.522c0-.859.22-1.541.66-2.046.456-.505 1.052-.764 1.793-.764.856 0 1.504.328 1.933.983L8 4.39l.417-.695c.429-.655 1.077-.983 1.934-.983.74 0 1.336.259 1.791.764.442.505.661 1.187.661 2.046v4.203z"/> </svg></span><span>vsantos</span> </a> </li> <li> <a href="https://twitter.com/Vctrsnts1"> <span class="align-middle text-secondary pr-2"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-twitter" viewBox="0 0 16 16"> <path d="M5.026 15c6.038 0 9.341-5.003 9.341-9.334 0-.14 0-.282-.006-.422A6.685 6.685 0 0 0 16 3.542a6.658 6.658 0 0 1-1.889.518 3.301 3.301 0 0 0 1.447-1.817 6.533 6.533 0 0 1-2.087.793A3.286 3.286 0 0 0 7.875 6.03a9.325 9.325 0 0 1-6.767-3.429 3.289 3.289 0 0 0 1.018 4.382A3.323 3.323 0 0 1 .64 6.575v.045a3.288 3.288 0 0 0 2.632 3.218 3.203 3.203 0 0 1-.865.115 3.23 3.23 0 0 1-.614-.057 3.283 3.283 0 0 0 3.067 2.277A6.588 6.588 0 0 1 .78 13.58a6.32 6.32 0 0 1-.78-.045A9.344 9.344 0 0 0 5.026 15z"/> </svg></span><span>Vctrsnts1</span> </a> </li> </ul> </div> <div class="col-12 col-lg"> <p class="text-secondary text-justify">Bienvenido a mi Blog personal. Aqui encontraras tutoriales y notas que voy tomando cuando hago mis instalaciones, configuraciones, pruebas, etc... </p> </div> </div> </div> </footer> </body> </html>
